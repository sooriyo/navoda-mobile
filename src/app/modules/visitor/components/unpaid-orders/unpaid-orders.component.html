<!-- unpaid-orders.component.html -->
<div class="container mx-auto px-4 py-6 max-w-4xl">
    <!-- Shop Selection -->
    <div class="bg-white rounded-lg shadow-md p-4 mb-6">
        <h2 class="text-lg font-semibold text-gray-800 mb-4">Credit Orders</h2>
        <div class="relative">
            <select
                    [(ngModel)]="selectedShop"
                    name="shop"
                    (change)="onShopChange()"
                    class="w-full p-2.5 bg-gray-50 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 appearance-none">
                <option value="">All Shops</option>
                <option *ngFor="let shop of shops" [value]="shop.id">
                    {{ shop.name }}
                </option>
            </select>
        </div>
    </div>

    <!-- Summary Cards -->
    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
        <div class="bg-white rounded-lg shadow-md p-4">
            <div class="text-sm text-gray-600">Total Outstanding</div>
            <div class="text-2xl font-semibold text-blue-600">{{ getTotalOutstanding() | currency }}</div>
        </div>
        <div class="bg-white rounded-lg shadow-md p-4">
            <div class="text-sm text-gray-600">Overdue (>30 days)</div>
            <div class="text-2xl font-semibold text-red-600">{{ getOverdueAmount() | currency }}</div>
        </div>
    </div>

    <!-- Unpaid Orders Section -->
    <div class="bg-white rounded-lg shadow-md p-4">
        <div class="flex flex-col md:flex-row justify-between items-stretch md:items-center mb-4 gap-4">
            <!-- Search Input -->
            <div class="flex-1">
                <input
                        type="text"
                        [(ngModel)]="searchTerm"
                        (ngModelChange)="applyFilters()"
                        placeholder="Search order no, shop..."
                        class="w-full p-2.5 bg-gray-50 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
            </div>

            <!-- Date Filter -->
            <div class="w-full md:w-48">
                <select
                        [(ngModel)]="dateFilter"
                        (ngModelChange)="applyFilters()"
                        class="w-full p-2.5 bg-gray-50 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 appearance-none">
                    <option value="all">All Time</option>
                    <option value="7">Last 7 Days</option>
                    <option value="30">Last 30 Days</option>
                    <option value="90">Last 90 Days</option>
                </select>
            </div>
        </div>

        <!-- Orders Table -->
        <div class="overflow-x-auto">
            <table class="w-full min-w-full divide-y divide-gray-200">
                <thead class="bg-gray-50">
                <tr>
                    <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">Order No</th>
                    <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">Shop</th>
                    <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">Date</th>
                    <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">Amount</th>
                    <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">Age</th>
                    <th class="px-4 py-3 text-center text-xs font-medium text-gray-500 uppercase">Actions</th>
                </tr>
                </thead>
                <tbody class="bg-white divide-y divide-gray-200">
                <tr *ngFor="let order of filteredOrders">
                    <td class="px-4 py-3">
                        <div class="text-sm font-medium text-gray-900">{{ order.orderNo }}</div>
                        <div class="text-xs text-gray-500">{{ order.items.length }} items</div>
                    </td>
                    <td class="px-4 py-3 text-sm">{{ order.shopName }}</td>
                    <td class="px-4 py-3 text-sm">{{ order.date | date:'mediumDate' }}</td>
                    <td class="px-4 py-3 text-sm font-medium">{{ order.amount | currency }}</td>
                    <td class="px-4 py-3">
                            <span [ngClass]="{
                                'px-2 py-1 rounded-full text-xs font-medium': true,
                                'bg-green-100 text-green-800': order.age < 7,
                                'bg-yellow-100 text-yellow-800': order.age >= 7 && order.age < 30,
                                'bg-red-100 text-red-800': order.age >= 30
                            }">
                                {{ order.age }} days
                            </span>
                    </td>
                    <td class="px-4 py-3">
                        <div class="flex justify-center gap-2">
                            <button
                                    (click)="markAsPaid(order)"
                                    class="px-3 py-1 bg-green-600 text-white rounded-md hover:bg-green-700 text-sm">
                                Pay
                            </button>
                            <button
                                    (click)="viewDetails(order)"
                                    class="px-3 py-1 bg-blue-100 text-blue-600 rounded-md hover:bg-blue-200 text-sm">
                                Details
                            </button>
                        </div>
                    </td>
                </tr>
                <!-- Empty State -->
                <tr *ngIf="filteredOrders.length === 0">
                    <td colspan="6" class="px-4 py-8 text-center text-gray-500">
                        No unpaid orders found
                    </td>
                </tr>
                </tbody>
            </table>
        </div>

        <!-- Pagination -->
        <div class="flex flex-col md:flex-row items-center justify-between mt-4 gap-4">
            <div class="text-sm text-gray-600">
                Showing {{ startIndex + 1 }} to {{ endIndex }} of {{ totalItems }} orders
            </div>
            <div class="flex gap-2">
                <button
                        (click)="previousPage()"
                        [disabled]="currentPage === 1"
                        class="px-3 py-1 bg-gray-100 text-gray-600 rounded-md hover:bg-gray-200 disabled:opacity-50 disabled:cursor-not-allowed">
                    Previous
                </button>
                <button
                        (click)="nextPage()"
                        [disabled]="isLastPage"
                        class="px-3 py-1 bg-gray-100 text-gray-600 rounded-md hover:bg-gray-200 disabled:opacity-50 disabled:cursor-not-allowed">
                    Next
                </button>
            </div>
        </div>
    </div>
</div>

